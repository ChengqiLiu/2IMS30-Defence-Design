/***************************************************************************//**
 * @file
 * @brief File System - Fat Directory Operations
 *******************************************************************************
 * # License
 * <b>Copyright 2018 Silicon Laboratories Inc. www.silabs.com</b>
 *******************************************************************************
 *
 * The licensor of this software is Silicon Laboratories Inc.  Your use of this
 * software is governed by the terms of Silicon Labs Master Software License
 * Agreement (MSLA) available at
 * www.silabs.com/about-us/legal/master-software-license-agreement.
 * The software is governed by the sections of the MSLA applicable to Micrium
 * Software.
 *
 ******************************************************************************/

/********************************************************************************************************
 ********************************************************************************************************
 *                                               MODULE
 ********************************************************************************************************
 *******************************************************************************************************/

#ifndef  FS_FAT_DIR_PRIV_H_
#define  FS_FAT_DIR_PRIV_H_

/********************************************************************************************************
 ********************************************************************************************************
 *                                           INCLUDE FILES
 ********************************************************************************************************
 *******************************************************************************************************/

//                                                                 ----------------------- CFG ------------------------
#include  <common/include/rtos_path.h>
#include  <fs_core_cfg.h>

#if (FS_CORE_CFG_DIR_EN == DEF_ENABLED)

#include  <fs/source/sys/fat/fs_fat_priv.h>
#include  <fs/source/core/fs_core_dir_priv.h>
#include  <cpu/include/cpu.h>
#include  <common/include/rtos_err.h>

/********************************************************************************************************
 ********************************************************************************************************
 *                                               DEFINES
 ********************************************************************************************************
 *******************************************************************************************************/

#define FS_FAT_DIR_TBL_SPECIAL_ENTRY_QTY            2u

/********************************************************************************************************
 ********************************************************************************************************
 *                                               DATA TYPES
 ********************************************************************************************************
 *******************************************************************************************************/

typedef struct fs_fat_dir_node {
  FS_DIR_NODE     DirNode;
  FS_FAT_CLUS_NBR FirstClusNbr;
} FS_FAT_DIR_NODE;

typedef struct fs_fat_dir_desc {
  FS_DIR_DESC DirDesc;
  CPU_SIZE_T  CurDirEntryIx;
} FS_FAT_DIR_DESC;

/********************************************************************************************************
 ********************************************************************************************************
 *                                           FUNCTION PROTOTYPES
 ********************************************************************************************************
 *******************************************************************************************************/

/********************************************************************************************************
 *                                       INTERNAL FUNCTION PROTOTYPES
 *******************************************************************************************************/

void FS_FAT_DirModuleInit(RTOS_ERR *p_err);

/********************************************************************************************************
 *                                   SYSTEM DRIVER FUNCTION PROTOTYPES
 *******************************************************************************************************/

CPU_BOOLEAN FS_FAT_DirRd(FS_DIR_DESC   *p_dir_desc,
                         FS_SYS_POS    *p_cur_pos_data,
                         FS_ENTRY_INFO *p_entry_info,
                         CPU_CHAR      *p_name,
                         CPU_SIZE_T    name_buf_size,
                         RTOS_ERR      *p_err);

CPU_BOOLEAN FS_FAT_DirChkEmpty(FS_VOL     *p_vol,
                               FS_SYS_POS *p_dirent_pos,
                               RTOS_ERR   *p_err);

FS_DIR_NODE *FS_FAT_DirNodeAlloc(RTOS_ERR *p_err);

void FS_FAT_DirNodeFree(FS_DIR_NODE *p_fat_dir_node);

FS_DIR_DESC *FS_FAT_DirDescAlloc(RTOS_ERR *p_err);

void FS_FAT_DirDescFree(FS_DIR_DESC *p_fat_dir_desc);

void FS_FAT_DirNodeInit(FS_DIR_NODE *p_dir_node,
                        FS_SYS_POS  entry_sys_pos,
                        RTOS_ERR    *p_err);

void FS_FAT_DirDescInit(FS_DIR_DESC *p_dir_desc,
                        RTOS_ERR    *p_err);

#endif

/********************************************************************************************************
 ********************************************************************************************************
 *                                               MODULE END
 ********************************************************************************************************
 *******************************************************************************************************/

#endif
